services:
    _defaults:
        autowire: true
        autoconfigure: true

    baihu.plugin.loader:
        class: baihu\baihu\src\plugin\loader
        autowire: false
        arguments:
            - '@dbal.conn'
            - '@baihu.plugin.collection'
            - '@baihu.plugin.data'
            - '%baihu.tables.plugins%'
            - '%baihu.tables.plugins_on_page%'

    baihu.plugin.data:
        class: baihu\baihu\src\plugin\data

    baihu.plugin_subscriber:
        class: baihu\baihu\src\plugin\event\plugin_subscriber
        tags:
            - { name: event.listener }

    baihu.posts:
        class: baihu\baihu\src\plugin\posts\posts
        tags: ['container.service_subscriber']

    baihu\baihu\src\plugin\loader: '@baihu.plugin.loader'
    baihu\baihu\src\plugin\data: '@baihu.plugin.data'
    baihu\baihu\src\plugin\posts\posts: '@baihu.posts'

# ----- Plugins -----
    baihu.plugin.collection:
        class: phpbb\di\service_collection
        arguments:
            - '@service_container'
        tags:
            - { name: service_collection, tag: baihu.plugin }

    baihu.plugin.base:
        abstract: true

    baihu.baihu.plugin.mini_profile:
        class: baihu\baihu\src\plugin\sidebar\mini_profile
        calls:
            - [loadable, [false]]
            - [block, [true]]
        tags:
            - { name: baihu.plugin }
            - { name: container.service_subscriber }

    baihu.baihu.plugin.statistics:
        class: baihu\baihu\src\plugin\sidebar\statistics
        calls:
            - [loadable, [true]]
            - [block, [true]]
        tags:
            - { name: baihu.plugin }
            - { name: container.service_subscriber }

    baihu.baihu.plugin.group:
        class: baihu\baihu\src\plugin\sidebar\group
        calls:
            - [loadable, [true]]
            - [block, [true]]
        tags:
            - { name: baihu.plugin }
            - { name: container.service_subscriber }

    baihu.baihu.plugin.top_posters:
        class: baihu\baihu\src\plugin\sidebar\top_posters
        calls:
            - [loadable, [true]]
            - [block, [true]]
        tags:
            - { name: baihu.plugin }
            - { name: container.service_subscriber }

    baihu.baihu.plugin.recent_posts:
        class: baihu\baihu\src\plugin\sidebar\recent_posts
        calls:
            - [loadable, [true]]
            - [block, [true]]
        tags:
            - { name: baihu.plugin }
            - { name: container.service_subscriber }

    baihu.baihu.plugin.recent_topics:
        class: baihu\baihu\src\plugin\sidebar\recent_topics
        calls:
            - [loadable, [true]]
            - [block, [true]]
        tags:
            - { name: baihu.plugin }
            - { name: container.service_subscriber }
